{"version":3,"sources":["assets\\scripts\\slots\\Reel.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Aux from '../SlotEnum';\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class Reel extends cc.Component {\n  @property({ type: cc.Node })\n  public reelAnchor = null;\n\n  @property({ type: cc.Enum(Aux.Direction) })\n  public spinDirection = Aux.Direction.Down;\n\n  @property({ type: [cc.Node], visible: false })\n  private tiles = [];\n\n  @property({ type: cc.Prefab })\n  public _tilePrefab = null;\n\n  @property({ type: cc.Prefab })\n  get tilePrefab(): cc.Prefab {\n    return this._tilePrefab;\n  }\n\n  private winnersIndex = [];\n\n  set tilePrefab(newPrefab: cc.Prefab) {\n    this._tilePrefab = newPrefab;\n    this.reelAnchor.removeAllChildren();\n    this.tiles = [];\n\n    if (newPrefab !== null) {\n      this.createReel();\n      this.shuffle();\n    }\n  }\n\n  private result: Array<number> = [];\n\n  public stopSpinning = false;\n\n  createReel(): void {\n    let newTile: cc.Node;\n    if(this.reelAnchor.children.length > 0)\n    {\n      for (let i = 0; i < 5; i += 1) {\n        this.tiles[i] = this.reelAnchor.children[i];\n      }\n    }\n    else\n    {\n      for (let i = 0; i < 5; i += 1) {\n        newTile = cc.instantiate(this.tilePrefab);\n        this.reelAnchor.addChild(newTile);\n        this.tiles[i] = newTile;\n      }\n    }\n    this.shuffle();\n\n  }\n\n  shuffle(): void {\n    console.log(\"shuffle\");\n    for (let i = 0; i < this.tiles.length; i += 1) {\n      this.tiles[i].getComponent('Tile').setRandom();\n    }\n  }\n\n  readyStop(newResult: Array<number>, winnerIndexes: Array<number>): void {\n    const check = this.spinDirection === Aux.Direction.Down || newResult == null;\n    this.result = check ? newResult : newResult.reverse();\n    this.winnersIndex = winnerIndexes;\n    this.stopSpinning = true;\n  }\n\n  changeCallback(element: cc.Node = null): void {\n    const el = element;\n    const dirModifier = this.spinDirection === Aux.Direction.Down ? -1 : 1;\n    if (el.position.y * dirModifier > 288) {\n      el.position = cc.v2(0, -288 * dirModifier);\n\n      let pop = null;\n      if (this.result != null && this.result.length > 0) {\n        pop = this.result.pop();\n      }\n\n      if (pop != null && pop >= 0) {\n        el.getComponent('Tile').setTile(pop);\n        if(this.winnersIndex.indexOf(pop) >= 0)\n        {\n          el.getComponent('Tile').setAnimation(true);\n        }\n      } else {\n        el.getComponent('Tile').setRandom();\n      }\n    }\n  }\n\n  checkEndCallback(element: cc.Node = null): void {\n    const el = element;\n    if (this.stopSpinning) {\n      this.getComponent(cc.AudioSource).play();\n      this.doStop(el);\n    } else {\n      this.doSpinning(el);\n    }\n  }\n\n  doSpin(windUp: number): void {\n    this.stopSpinning = false;\n\n    this.reelAnchor.children.forEach(element => {\n      const dirModifier = this.spinDirection === Aux.Direction.Down ? -1 : 1;\n\n      const delay = cc.tween(element).delay(windUp);\n      const start = cc.tween(element).by(0.25, { position: cc.v2(0, 144 * dirModifier) }, { easing: 'backIn' });\n      const doChange = cc.tween().call(() => this.changeCallback(element));\n      const callSpinning = cc.tween(element).call(() => this.doSpinning(element, 5));\n\n      delay\n        .then(start)\n        .then(doChange)\n        .then(callSpinning)\n        .start();\n    });\n  }\n\n  doSpinning(element: cc.Node = null, times = 1): void {\n    const dirModifier = this.spinDirection === Aux.Direction.Down ? -1 : 1;\n\n    const move = cc.tween().by(0.04, { position: cc.v2(0, 144 * dirModifier) });\n    const doChange = cc.tween().call(() => this.changeCallback(element));\n    const repeat = cc.tween(element).repeat(times, move.then(doChange));\n    const checkEnd = cc.tween().call(() => this.checkEndCallback(element));\n\n    repeat.then(checkEnd).start();\n  }\n\n  doStop(element: cc.Node = null): void {\n    const dirModifier = this.spinDirection === Aux.Direction.Down ? -1 : 1;\n\n    const move = cc.tween(element).by(0.04, { position: cc.v2(0, 144 * dirModifier) });\n    const doChange = cc.tween().call(() => this.changeCallback(element));\n    const end = cc.tween().by(0.2, { position: cc.v2(0, 144 * dirModifier) }, { easing: 'bounceOut' });\n\n    move\n      .then(doChange)\n      .then(move)\n      .then(doChange)\n      .then(end)\n      .then(doChange)\n      .start();\n  }\n\n  setAnimation(value): void{\n    for (let i = 0; i < this.tiles.length; i += 1) {\n      this.tiles[i].getComponent('Tile').setAnimation(value);\n    }\n  }\n}\n "]}
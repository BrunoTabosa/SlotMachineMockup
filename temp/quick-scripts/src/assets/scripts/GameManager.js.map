{"version":3,"sources":["assets\\scripts\\GameManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class GameManager extends cc.Component {\n  @property(cc.Node)\n  machine = null;\n\n  @property({ type: cc.AudioClip })\n  audioClick = null;\n\n  private block = false;\n\n  private result = null;\n  private winnersIndex;\n  private tileTextures = 29;\n\n  start(): void {\n    this.machine.getComponent('Machine').createMachine();\n  }\n\n  update(): void {\n    if (this.block && this.result != null) {\n      this.informStop();\n      this.result = null;\n    }\n  }\n\n  click(): void {\n    cc.audioEngine.playEffect(this.audioClick, false);\n\n    if (this.machine.getComponent('Machine').spinning === false) {\n      this.block = false;\n      this.machine.getComponent('Machine').spin();\n      this.requestResult();\n    } else if (!this.block) {\n      this.block = true;\n      this.machine.getComponent('Machine').lock();\n    }\n  }\n\n  async requestResult(): Promise<void> {\n    this.result = null;\n    this.result = await this.getAnswer();\n  }\n\n  getAnswer(): Promise<Array<Array<number>>> {\n    const randomResult = Math.random();\n    var slotResult = [];\n    \n    if(randomResult <= 0.5)\n    {\n      console.log(\"Random return\");\n      this.winnersIndex = [-1];\n    }\n    else if(randomResult <= 0.83)\n    {\n      console.log(\"Single Line\");\n      this.winnersIndex = this.getUniqueRandomNumbersBetween(0, this.tileTextures, 1);\n      slotResult = this.generateMachineResult(-1, this.winnersIndex[0], -1);\n    }\n    else if(randomResult <= 0.93)\n    {\n      //Two lines  \n      console.log(\"Two lines\");\n      this.winnersIndex = this.getUniqueRandomNumbersBetween(0, this.tileTextures, 2);\n      slotResult = this.generateMachineResult(this.winnersIndex[0], this.winnersIndex[1], -1);\n    }\n    else if(randomResult <= 1)\n    {\n      console.log(\"three lines\");\n      this.winnersIndex = this.getUniqueRandomNumbersBetween(0, this.tileTextures, 3);\n      slotResult = this.generateMachineResult(this.winnersIndex[0], this.winnersIndex[1], this.winnersIndex[2]);\n    }\n    \n    \n    return new Promise<Array<Array<number>>>(resolve => {\n      setTimeout(() => {\n        resolve(slotResult);\n      }, 1000 + 500 * Math.random());\n    });\n  }\n\n  informStop(): void {\n    const resultRelayed = this.result;\n    this.machine.getComponent('Machine').stop(resultRelayed, this.winnersIndex);\n  }\n\n  generateMachineResult(first, second, third): Array<Array<number>>\n  {\n    var ret = Array<Array<number>>();\n\n    for (let index = 0; index < 6; index++) {\n      ret.push(this.generateReelResult(first, second, third));\n    }\n    return ret;\n  }\n\n  generateReelResult(first, second, third): Array<number>\n  {\n    var excluding = Array<number>();\n    var ret = Array<number>(first,second,third);\n    \n    excluding.push(first);\n    excluding.push(second);\n    excluding.push(third);\n    var curNum;\n    if(first < 0)\n    {\n      curNum = this.getRandomNumberExcluding(0, this.tileTextures, excluding);\n      ret[0] = curNum;\n      excluding.push(curNum);\n    }\n    if(second < 0)\n    {\n      curNum = this.getRandomNumberExcluding(0, this.tileTextures, excluding);\n      ret[1] = curNum;\n      excluding.push(curNum);\n    }\n    if(third < 0)\n    {\n      curNum = this.getRandomNumberExcluding(0, this.tileTextures, excluding);\n      ret[2] = curNum;\n      excluding.push(curNum);\n    }\n\n    return ret;\n  }\n\n  getRandomNumberBetween(min, max): number\n  {\n    return Math.floor(Math.random()*(max-min+1)+min);\n  }\n\n  getUniqueRandomNumbersBetween(min, max, amount): Array<number>\n  {\n    var ret = Array<number>();\n    for (let index = 0; index < amount; index++) {\n      var added = false;\n      while(!added)\n      {\n        var curNum = this.getRandomNumberBetween(min, max);\n        if(ret.indexOf(curNum) < 0)\n        {\n          ret.push(curNum);\n          added = true;\n        }\n      }\n      \n    }\n    return ret;\n  }\n\n  getRandomNumberExcluding(min, max, excluding): number\n  {\n    var found = false;\n    while(!found)\n    {\n      var curNum = this.getRandomNumberBetween(min, max);\n      if(excluding.indexOf(curNum) <= -1)\n        {\n          found = true;\n          return curNum;\n        }\n    }\n  }\n}\n"]}